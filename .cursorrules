# ================================
# Cursor Rules for Flex Microservice - .NET 9 + Microservices
# ================================
version: 2

# ----------------
# GENERAL CONTEXT
# ----------------
context:
  description: |
    Flex Microservice là hệ thống quản lý chứng khoán theo kiến trúc microservices, sử dụng .NET 9, 
    được thiết kế để xử lý giao dịch chứng khoán real-time, quản lý danh mục đầu tư, streaming dữ liệu thị trường. 
    Hệ thống bao gồm các service độc lập: Securities, Investor, Identity, Ordering, Inventory, System, Basket, 
    và các building blocks chung như Infrastructure, Shared, Contracts.
  conventions: |
    - Tên service viết PascalCase với prefix "Flex." (ví dụ: Flex.Securities.Api)
    - Tên container viết thường, phân tách bằng dấu gạch (ví dụ: securities-api)
    - Tên volumes kết thúc bằng _data (ví dụ: securities_data)
    - Sử dụng biến môi trường cho thông tin nhạy cảm (connection strings, passwords)
    - Images phải chỉ định version cụ thể (.NET 9.0)
    - Sử dụng docker-compose.override.yml cho cấu hình local/dev

# ----------------
# BACKEND RULES
# ----------------
backend:
  framework: ".NET 9.0 (latest LTS)"
  architecture: |
    - Microservices: mỗi service là một container riêng biệt
    - Building Blocks: Infrastructure, Shared, Contracts, EventBus.Messages
    - Modules: Security, Redis, SeriLog, Swashbuckle, EntityFrameworkCore
    - Services: Securities, Investor, Identity, Ordering, Inventory, System, Basket, Job
    - API Gateway: Ocelot cho routing và load balancing
  naming_conventions: |
    - Tên container: trùng với tên service, viết thường (ví dụ: securities-api)
    - Biến môi trường: viết hoa, phân tách bằng dấu gạch dưới (ví dụ: DEFAULT_CONNECTION)
    - Tên project: Flex.{ServiceName}.{Layer} (ví dụ: Flex.Securities.Api)
  patterns: |
    - Sử dụng docker-compose để orchestration
    - Sử dụng volumes để persist dữ liệu
    - Sử dụng environment variables cho cấu hình động
    - Entity Framework Core với Oracle database
    - Redis cho caching
    - SeriLog cho logging
    - Swagger cho API documentation

# ----------------
# SERVICES STRUCTURE
# ----------------
services:
  securities: |
    - Flex.Securities.Api: API chính cho quản lý chứng khoán
    - Port: 5000 (Docker), 7001 (Development)
    - Database: Oracle với Entity Framework Core
    - Features: Trade processing, portfolio management, market data
  investor: |
    - Flex.Investor.Api: API quản lý nhà đầu tư
    - Port: 7003 (Development)
    - Features: Investor profiles, account management
  identity: |
    - Flex.IdentityServer.Api: Identity Server với Duende
    - Flex.AspNetIdentity.Api: ASP.NET Core Identity
    - Port: 7002 (IdentityServer), 7102 (AspNetIdentity)
    - Features: Authentication, authorization, user management
  ordering: |
    - Flex.Ordering.Api: API quản lý đơn hàng
    - Flex.Ordering.Domain: Domain layer
    - Flex.Ordering.Application: Application layer
    - Flex.Ordering.Infrastructure: Infrastructure layer
    - Port: 7004 (Development)
    - Features: Order processing, workflow management
  inventory: |
    - Flex.Inventory.Api: API quản lý kho
    - Flex.Inventory.Grpc: gRPC service
    - Port: 7005 (API), 7006 (gRPC)
    - Features: Stock management, inventory tracking
  system: |
    - Flex.System.Api: API quản lý hệ thống
    - Port: 7007 (Development)
    - Features: System configuration, health checks
  basket: |
    - Flex.Basket.Api: API giỏ hàng
    - Port: 7008 (Development)
    - Features: Shopping cart functionality
  job: |
    - Flex.EmailJob.Api: Background job service
    - Port: 7009 (Development)
    - Features: Email processing, scheduled tasks

# ----------------
# BUILDING BLOCKS
# ----------------
building_blocks: |
  - Flex.Infrastructure: Common infrastructure components
  - Flex.Shared: Shared DTOs, enums, constants
  - Flex.Contracts: Domain contracts and interfaces
  - Flex.EventBus.Messages: Event bus message definitions
  - Flex.Shared.Authorization: Authorization constants and permissions
  - Flex.Grpc.Protos: gRPC protocol buffer definitions
  - Flex.Common.Logging: Common logging components

# ----------------
# MODULES
# ----------------
modules: |
  - Flex.Security: JWT authentication, token management
  - Flex.Redis: Redis caching and session management
  - Flex.SeriLog: Structured logging with Serilog
  - Flex.Swashbuckle: Swagger/OpenAPI documentation
  - Flex.EntityFrameworkCore: Entity Framework Core extensions
  - Flex.EntityFrameworkCore.Oracle: Oracle database provider
  - Flex.Hangfire: Background job processing
  - Flex.MediaR: CQRS pattern implementation
  - Flex.DependencyInjection: DI container configuration
  - Flex.Data: Database connection management

# ----------------
# DEVOPS RULES
# ----------------
devops:
  deployment: |
    - Sử dụng docker-compose để deploy toàn bộ môi trường
    - Sử dụng docker-compose.override.yml cho cấu hình local/dev
    - Port mapping rõ ràng, tránh trùng lặp
    - Sử dụng Jenkins pipeline cho CI/CD
    - Terraform cho infrastructure provisioning
  ci_cd: |
    - Jenkins pipeline cho build, test, deploy
    - Docker images với .NET 9.0 runtime
    - Automated testing với unit tests
    - Secrets management cho thông tin nhạy cảm

# ----------------
# TESTING RULES
# ----------------
testing: |
  - Viết unit test cho từng service
  - Integration test với database containers
  - API testing với Swagger/OpenAPI
  - Performance testing cho high-load scenarios

# ----------------
# FILE & FOLDER STRUCTURE
# ----------------
file_structure: |
  - docker-compose.yml: chỉ lưu image kèm version/tag cho từng service
  - docker-compose.override.yml: cấu hình bổ sung cho môi trường local/dev
  - src/Services/: chứa các microservices
  - src/BuildingBlocks/: chứa các shared components
  - src/Modules/: chứa các reusable modules
  - src/ApiGateways/: chứa API Gateway
  - src/WebApps/: chứa web applications
  - volumes đặt tên theo convention: <service>_data
  - Mỗi service có cấu trúc: Api, Domain, Application, Infrastructure (nếu cần)

# ----------------
# DATABASE & INFRASTRUCTURE
# ----------------
infrastructure: |
  - Database: Oracle với Entity Framework Core
  - Cache: Redis cho session và caching
  - Message Broker: RabbitMQ (được đề cập trong docs)
  - API Gateway: Ocelot cho routing
  - Monitoring: Health checks và logging
  - Security: JWT tokens, Identity Server

# ----------------
# DEVELOPMENT GUIDELINES
# ----------------
development: |
  - Sử dụng .NET 9.0 SDK
  - Follow CQRS pattern với MediatR
  - Implement proper logging với Serilog
  - Use AutoMapper cho object mapping
  - Implement proper error handling và validation
  - Follow RESTful API conventions
  - Use async/await patterns
  - Implement proper dependency injection
